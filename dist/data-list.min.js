var DataList=function(t,e,i,n,a,r,o){"use strict";function s(t){s.installed||(s.installed=!0,t.component("DataList",c))}e=e&&e.hasOwnProperty("default")?e.default:e,i=i&&i.hasOwnProperty("default")?i.default:i,n=n&&n.hasOwnProperty("default")?n.default:n,a=a&&a.hasOwnProperty("default")?a.default:a,r=r&&r.hasOwnProperty("default")?r.default:r,o=o&&o.hasOwnProperty("default")?o.default:o,function(){if("undefined"!=typeof document){var t=document.head||document.getElementsByTagName("head")[0],e=document.createElement("style"),i=".data-list .loaded-tip { height: 0; opacity: 0; animation: tipHidden 3s; } @-moz-keyframes tipHidden { from { opacity: 1; height: 50px; } to { opacity: 0; height: 0; } } @-webkit-keyframes tipHidden { from { opacity: 1; height: 50px; } to { opacity: 0; height: 0; } } @-o-keyframes tipHidden { from { opacity: 1; height: 50px; } to { opacity: 0; height: 0; } } @keyframes tipHidden { from { opacity: 1; height: 50px; } to { opacity: 0; height: 0; } } ";e.type="text/css",e.styleSheet?e.styleSheet.cssText=i:e.appendChild(document.createTextNode(i)),t.appendChild(e)}}();var l=new RegExp("~","g"),d=new RegExp("q=.*,"),c={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"data-list"},[t.canPrev?i("infinite-loading",t._b({ref:"infiniteLoading",attrs:{distance:t.distance,identifier:t.identifier,direction:"top"},on:{infinite:function(e){t.getList(e,t.directionUp)}}},"infinite-loading",t.$attrs,!1),[i("div",{staticClass:"loaded-tip",attrs:{slot:"no-more"},slot:"no-more"},[t._t("no-more",[t._v(" 已经到达顶部了 ")])],2),t._v(" "),i("div",{staticClass:"loaded-tip",attrs:{slot:"no-results"},slot:"no-results"},[t._t("no-results",[t._v(" 暂时没有数据 ")])],2),t._v(" "),i("div",{attrs:{slot:"error"},slot:"error"},[t._t("error",[t._v(" 网络异常，请刷新重试 ")])],2)]):t._e(),t._v(" "),t._t("default",[t._v(" 自定义列表内容 ")],{list:t.list}),t._v(" "),i("infinite-loading",t._b({ref:"infiniteLoading",attrs:{identifier:t.identifier,direction:"bottom"},on:{infinite:function(e){t.getList(e,t.directionDown)}}},"infinite-loading",t.$attrs,!1),[t._t("no-more",[t._v(" 没有更多了 ")],{slot:"no-more"}),t._v(" "),t._t("no-results",[t._v(" 暂时没有数据 ")],{slot:"no-results"}),t._v(" "),t._t("error",[t._v(" 网络异常，请刷新重试 ")],{slot:"error"})],2)],2)},staticRenderFns:[],name:"data-list",components:{InfiniteLoading:a},props:{url:String,query:{type:Object,default:function(){}},dataPath:{type:String,default:"payload.content"},totalPagesPath:{type:String,default:"payload.totalPages"},size:{type:Number,default:10},hasPagination:{type:Boolean,default:!0},noPaginationSize:{type:Number,default:999},saveQuery:{type:Boolean,default:!0},routerMode:{type:String,default:"hash"}},data:function(){return{list:[],nextPage:1,identifier:0,prevPage:1,distance:-100,canPrev:!1,directionUp:"top",directionDown:"bottom",storeQuery:null,scrollParent:null}},watch:{url:function(){this.reset()}},mounted:function(){var t=location.href.match(d);if(t){var e=t[0].substr(2).replace(l,"=");this.storeQuery=r.parse(e,{delimiter:","}),this.nextPage=this.storeQuery.page,this.prevPage=this.storeQuery.page}this.scrollParent=this.$refs.infiniteLoading.getScrollParent(),this.scrollParent.addEventListener("scroll",this.updatePrevDistance)},destroyed:function(){this.scrollParent.removeEventListener("scroll",this.updatePrevDistance)},methods:{getList:function(){function t(t,e){return a.apply(this,arguments)}var a=n(e.mark(function t(n,a){var r,s,l,c,h,u,p,f,g,y,v,m,P,_;return e.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=a===this.directionDown,s=this.url,l="",s&&(r||1!=this.prevPage)){t.next=7;break}return n.complete(),console.warn("url 为空, 不发送请求"),t.abrupt("return");case 7:return s.indexOf("?")>-1?s+="&":s+="?",r||this.prevPage--,c=this.hasPagination?this.size:this.noPaginationSize,h=Object.assign({},this.storeQuery,{page:r?this.nextPage:this.prevPage,size:c},this.query),l+=Object.keys(h).filter(function(t){return""!==h[t]&&null!==h[t]&&void 0!==h[t]}).reduce(function(t,e,i){return t+=(0===i?"":"&")+e+"="+encodeURIComponent(h[e].toString().trim())},""),this.$emit("loading"),t.prev=13,t.next=16,this.$axios.get(s+l);case 16:p=t.sent,f=p.data,g=o(f,this.dataPath,[]),r?this.list=this.list.concat(g):(u=this.list).unshift.apply(u,i(g)),r&&this.nextPage++,this.list.length&&n.loaded(),this.$emit("loaded",[].concat(i(this.list))),y=o(f,this.totalPagesPath,0),r&&this.nextPage>y&&(n.complete(),1!=y&&this.updatePrevDistance()),t.next=31;break;case 27:t.prev=27,t.t0=t.catch(13),n.error(),this.$emit("error",t.t0);case 31:this.saveQuery&&this.routerMode&&(v="",m="q="+l.replace(/&/g,",").replace(/=/g,"~")+",",location.href.indexOf("q=")>-1?v=location.href.replace(d,m):"hash"===this.routerMode?(P=location.href.indexOf("?")>-1?"&"+m:"?"+m,v=location.origin+location.pathname+location.search+location.hash+P):(_=location.search?"&"+m:"?"+m,v=location.origin+location.pathname+location.search+_+location.hash),history.replaceState(history.state,"data-list loaded",v));case 32:case"end":return t.stop()}},t,this,[[13,27]])}));return t}(),updatePrevDistance:function(){this.distance=0,1!=this.prevPage&&(this.canPrev=!0),this.scrollParent.removeEventListener("scroll",this.updatePrevDistance)},reset:function(){this.list=[],this.nextPage=1,this.prevPage=1,history.replaceState(history.state,"",location.href.replace(d,"")),this.identifier+=1}}},h={install:s},u=null;return"undefined"!=typeof window?u=window.Vue:"undefined"!=typeof global&&(u=global.Vue),u&&u.use(h),t.install=s,t.default=c,t}({},_regeneratorRuntime,_toConsumableArray,_asyncToGenerator,InfiniteLoading,qs,_get);
